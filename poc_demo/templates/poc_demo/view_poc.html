{% extends "poc_demo/base.html" %}
{% block poc_content %}  
{% load static %}
<div class="app-content content">
    <div class="content-wrapper">
      <div class="content-header row">
      </div>
    <div class="content-body">
        <!-- Zero configuration table -->
    <section id="configuration">
        <div class="row">
            
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Projects list</h4>
                        <a class="heading-elements-toggle"><i class="fa fa-ellipsis-v font-medium-3"></i></a>
                        <div class="col-md-2 ms-auto mt-2" style="margin-left: 100px;">

                            {% if 'add_poc' in permission_names %}
                             <div class="text-end">
                            <a href="{% url 'add_poc' %}" class="btn btn-primary btn-sm m-2">Add Project</a>
                            </div>
                            {% endif %}
                            <form method="get" id="filter-form" class="form-inline">
                            <input type="text" name="search" placeholder="Search.." id="search" class="form-control ms-auto" value="{{ search_query }}">
                          </form></div>
                    </div>
                    <div class="card-content collapse show">
                        <div class="card-body card-dashboard">
                            <table id = 'my_poc_view' class="table table-striped table-bordered zero-configuration">
                                <thead>
                                    <tr>
                                        <th>Customer Name</th>
                                        <th>Product Name</th>
                                        <!-- <th>Features</th>
                                        <th>Remarks</th> -->
                                        <th> Detail </th>
                                        <th> Type </th>
                                        <th>Requested Date</th>
                                        <th>Timeline</th>
                                        <th>Status</th>
                                        <th>Added By</th>
                                        {% if  request.user.role.name  == 'Approval' or request.user.role.name  == 'Sales'  %}
                                        <th>Request</th>
                                        {% endif %}


                                    </tr>
                                </thead>
                                <tbody>
                                    {% if not page.object_list %}
                                    <tr> <td colspan="10"><h5 style="text-align:center">No data found</h5></td> </tr>
                                    {% endif %}
                                    {% for i in page.object_list %}
                                    <tr>
                                        <td>{{i.Customer_name}}</td>
                                        <td>{{i.Product_name}}</td>
                                        <td><a href="{% url 'view_poc_detail' i.id %}" class="btn btn-primary" value="">View</a></td>
                                        <td>{{i.poc_type}}</td>
                                        <td>{{i.Requested_date}}</td>
                                        <td>{{i.Timeline}}</td>
                                        <td>{{i.status}}</td>
                                        <td>{{i.added_by}}</td>
                                        {% if  request.user.role.name  == 'Sales' %}
                                        <td>
                                            {% if i.status.name == 'Pending' %}
                                            <a class="btn btn-info">Waiting For Confirmation</a>
                                            {% elif i.status.name == 'Rejected' %}
                                                <a class="btn btn-warning">Rejected</a>
                                            {% elif i.status.name != 'Rejected' %}
                                                <a class="btn btn-primary">Approved</a>
                                            {% endif %}
                                        </td>
                                        {% endif %}
                                        {% if  request.user.role.name  == 'Approval' %}
                                        <td>
                                        <!-- <td><button type ='button' class = 'btn btn-sm-primary'>add</button> -->
<!--                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" id ='{{i.id}}' data-bs-target="#centeredModal" onclick="set_id(this.id)">-->
<!--                                                ADD-->
<!--                                              </button>-->
                                            {% if i.status.name == 'Pending' %}
                                            {% if "approved_status" in permission_names %}
                                                <a onclick="return confirmApprove('{% url 'approved_status' i.id %}?param1=Accepted&param2=POC')" class="btn btn-primary" value="">Approve</a>
                                                <a class="btn btn-danger" data-bs-toggle="modal" id ='{{i.id}}' data-bs-target="#centeredModal" onclick="set_id(this.id)">Reject</a>
                                            {% else %}
                                                <a class="btn btn-warning">Pending</a>
                                            {% endif %}
                                            {% elif i.status.name == 'Rejected' %}
                                                <a class="btn btn-warning">Rejected</a>
                                            {% elif i.status.name != 'Rejected' %}
                                                <a class="btn btn-primary">Approved</a>
                                            {% endif %}
                                        </td>
                                        {% endif %}

                                    </tr>
                                    {% endfor %}
                                
                                    </tbody>
                                <!-- <tfoot>
                                    <tr>
                                        <th>Name</th>
                                        <th>Position</th>
                                        <th>Office</th>
                                        <th>Age</th>
                                        <th>Start date</th>
                                        <th>Salary</th>
                                    </tr>
                                </tfoot> -->
                            </table>
                            <div class="paginator" align='center'>
                                <span style="color:black">Page {{page.number}} of {{page.paginator.num_pages}}</span>
                                <div class="pages">                  
                                {% if page.has_previous %}
                                <a href="?page={{page.previous_page_number}}">Previous</a>
                                {% endif %}
                                {% if page.has_next %}
                                <a href="?page={{page.next_page_number}}">Next</a>
                                {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div>
        </div>

    </section>

  <div class="modal fade" id="centeredModal" tabindex="-1" aria-labelledby="centeredModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="centeredModalLabel">Add Reason For Rejection</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <form method="post" action="{% url 'save_reject_desc' %}">
            {% csrf_token %}
              <div class="form-group col-md-12 mb-2">
                <input type="hidden" name="row__id" id="row__id">
                  <input type="hidden" name="row__type" id="row__type" value="POC">
              </div>
              <div class="form-group col-12 mb-2 ">

                      <div class="input-group mb-1" id = "desc">
                          <textarea placeholder="Add Reason" class="form-control" id="example-reason" name="reason"></textarea>
                      </div>
              </div>
        </div>
        <div class="modal-footer">
            <div class="form-actions col-12 mb-2">
                <div class="text-right">
                    <button type="submit" class="btn btn-primary">Submit <i class="ft-thumbs-up position-right"></i></button>
                    <button type="reset" class="btn btn-warning">Reset <i class="ft-refresh-cw position-right"></i></button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </form>
        </div>
      </div>
    </div>
  </div>

    <!--/ Zero configuration table -->

    <div class="modal fade" id="centeredModalFeture" tabindex="-1" aria-labelledby="centeredModalLabel2" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="centeredModalLabel2"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id = 'FetureCentered'>
            </div>
            <div class="modal-footer">
                <div class="form-actions col-12 mb-2">
                    <div class="text-right">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
  
            </div>
          </div>
        </div>
      </div>
      <!-- ----------------------------------------------------------------------- -->

      <div class="modal fade" id="centeredModalupdate" tabindex="-1" aria-labelledby="centeredModalLabel3" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <form>
                {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title" id="centeredModalLabel3"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <input type="hidden" id='sts_id' name="sts_id"> 
            <div class="modal-body" id = 'FeturestsCenteredupdate'>
                <input type="text" placeholder="Status" class="form-control" id="sts" name="sts">
            </div>
            <div class="modal-footer">
                <div class="form-actions col-12 mb-2">
                    <div class="text-right">
                        <button type="button" id="update_status_feature" class="btn btn-primary">Submit <i class="ft-thumbs-up position-right"></i></button>
                    <button type="reset" class="btn btn-warning">Reset <i class="ft-refresh-cw position-right"></i></button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
            </form>
            <div id = 'sts_update_response'></div>
          </div>
        </div>
      </div>    
      <!-- ----------------------------------------------------------------------- -->
</div>
</div>
</div>

    {% endblock %}

    {% block js %}
    <!-- <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script> -->

    <script>
      function confirmApprove(url) {
        if (confirm('Are you sure for Approve Project?')) {
          window.location.href = url;
        }
      }
      </script>



   <script>
    localStorage.setItem('typer', "new");
    function set_id(button_){
        document.getElementById('row__id').value  = button_
    }


    function update_sts(button){
    document.getElementById('sts_id').value = button.value;
    }

    function display(button_, centeredModalLabel2_val){
        // document.getElementById('FetureCentered').value = button_
        // alert(button_.value);
        document.getElementById("FetureCentered").innerHTML = button_.value;

        document.getElementById("centeredModalLabel2").innerHTML = centeredModalLabel2_val; 
        // document.getElementById('row_remark_id').value  = button_
    }
    
    function removeDiv(FeatureDiv) {
          const delDiv = FeatureDiv.parentNode.parentNode;
          delDiv.parentNode.removeChild(delDiv);
    }

    var Remark_count = 1
    document.getElementById('Remark_count').value = Remark_count;
    // document.getElementById("add_new_remark").addEventListener("click", function () {
    // Remark_count++;
    // var newRemarkDiv = document.createElement("div");
    // document.getElementById('Remark_count').value = Remark_count;
    // newRemarkDiv.className = "input-group mb-1";
    // newRemarkDiv.id = `remark_${Remark_count}`;

    // newRemarkDiv.innerHTML = ` <input type="text" placeholder="Remark" class="form-control" 
    //                         id="example-Remark-input_${Remark_count}" name="remarks"><span class="input-group-append" 
    //                         id="button-Remark_addon_${Remark_count}"><button class="btn btn-danger" type="button" 
    //                         id = "remove_Remark_${Remark_count}" data-repeater-delete onclick="removeDiv(this)"><i class="ft-x"></i></button>
    //                         </span>`
    // document.getElementById("repeater-group_remark").appendChild(newRemarkDiv);
    // });

   </script>



{% endblock %}